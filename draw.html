<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Shader Fun</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
        }
    </style>

    <script type="text/javascript" src="js/glsl-canvas.min.js"></script>
</head>

<body>
    <script>
        const canvas = document.createElement('canvas');
        const gl = canvas.getContext("webgl2");
        const options = {
            alpha: false,
            antialias: true,
            mode: 'flat',
            powerPreference: 'low-power'
        };
        const the_glsl = new glsl.Canvas(canvas, options);

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        const urlParams = new URLSearchParams(window.location.search);
        const shaderFile = urlParams.get('shader') || '00_color.frag';

        fetch(shaderFile)
            .then(response => {
                if (!response.ok) {
                    const basePath = window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/') + 1);
                    const likely_path = `${basePath}shaders/${shaderFile}`
                    console.log(`First attempt failed: ${shaderFile}, trying modified path: ${likely_path}`);
                    return fetch(likely_path);
                }
                return response;
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.text();
            })
            .then(shaderCode => {
                console.log(shaderCode);
                the_glsl.load(shaderCode);
            })
            .catch(error => {
                console.error('Error loading shader:', error);
            });

    </script>
</body>

</html>